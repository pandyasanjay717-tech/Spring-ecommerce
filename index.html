<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buyer Home - YesBag</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* --- GENERAL STYLES (UNCHANGED) --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: #fdfcf9; 
            min-height: 100vh; 
            padding-top: 60px; 
            color: #333;
            padding-bottom: 0;
            display: flex;
            flex-direction: column;
        }
        
        .header { 
            position: fixed; top: 0; left: 0; width: 100%; height: 60px; 
            background: #FFC300; 
            z-index: 1000; display: flex; 
            align-items: center; justify-content: space-between; 
            padding: 0 15px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .logo { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
        .icon-btn { 
            font-size: 20px; cursor: pointer; color: #2c3e50; 
            position: relative; padding: 5px; margin-left: 10px;
        }
        
        #notificationDot {
            display: none; 
            position: absolute;
            top: 2px;
            right: 0px;
            width: 10px;
            height: 10px;
            background-color: #E94C3D; 
            border-radius: 50%;
            border: 2px solid #FFC300; 
        }

        #cartBadge { 
            display: none; background: #E94C3D; 
            color: white; border-radius: 50%; 
            padding: 2px 6px; font-size: 10px; position: absolute; top: -8px; right: -8px; 
            font-weight: bold;
        }
        .hamburger-menu { 
            display: none; position: absolute; top: 65px; right: 10px; 
            background: white; border-radius: 8px; 
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            min-width: 160px; z-index: 100;
        }
        .hamburger-menu.show { display: block; }
        .hamburger-item { 
            padding: 12px 15px; text-align: left; cursor: pointer; 
            font-size: 15px; border-bottom: 1px solid #f0f0f0; 
            color: #555;
        }
        .hamburger-item:last-child { border-bottom: none; }
        .hamburger-item:hover { background: #fff8e6; }
        
        .search-container { padding: 15px; background: #fdfcf9; }
        .search-bar { 
            width: 100%; padding: 12px 20px; border: 1px solid #ddd;
            border-radius: 25px; 
            background: white; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); 
            font-size: 15px;
            transition: all 0.3s;
        }
        .search-bar:focus { border-color: #FFC300; box-shadow: 0 0 10px rgba(255,195,0,0.3); }

        .search-popup { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(248, 248, 248, 0.95); 
            z-index: 2000; backdrop-filter: blur(8px);
        }
        .search-popup-content { 
            position: absolute; top: 70px; left: 50%; transform: translateX(-50%); 
            width: 95%; max-height: 85vh; overflow-y: auto; padding: 20px 10px; 
            background: white; border-radius: 12px; 
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }
        .search-popup-input { 
            width: 100%; padding: 15px; border: none; font-size: 18px; 
            border-bottom: 2px solid #FFC300; outline: none; margin-bottom: 15px;
        }
        .search-results { 
            margin-top: 10px; 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); 
            gap: 15px; 
        }
        
        /* --- TOP CATEGORIES STYLES (UPDATED FOR SIZE & CREATIVITY) --- */
        .top-categories-section {
            padding: 10px 0; 
            background: white;
            border-bottom: 1px solid #eee;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            margin-bottom: 5px; 
        }
        
        .top-categories-container {
            display: flex;
            overflow-x: scroll; 
            -webkit-overflow-scrolling: touch; 
            padding: 0 15px; 
            gap: 20px; /* Increased gap */
        }
        
        .top-categories-container::-webkit-scrollbar {
            display: none; 
        }

        .category-item-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            text-decoration: none;
            color: #333;
            min-width: 80px; /* Increased min-width for larger icons and spacing */
            transition: transform 0.3s, opacity 0.3s;
        }
        
        .category-item-card:hover {
            transform: translateY(-5px); /* More dramatic lift */
            opacity: 0.9;
        }

        .category-logo {
            width: 70px; /* Increased Size to 70px */
            height: 70px; /* Increased Size to 70px */
            object-fit: contain;
            border-radius: 50%;
            background: #fff; 
            padding: 10px; /* Increased internal padding */
            box-shadow: 0 4px 18px rgba(0,0,0,0.15); /* Deeper shadow */
            border: 4px solid #FFC300; /* Thicker, prominent border */
            transition: all 0.3s;
        }
        
        .category-item-card:hover .category-logo {
            border-color: #E94C3D; /* Highlight border on hover */
            box-shadow: 0 0 25px rgba(255,195,0,0.6); /* Golden glow on hover */
        }

        .category-name {
            margin-top: 6px; 
            font-size: 14px; /* Increased size for easy reading */
            font-weight: 700; /* Bolder font */
            color: #2c3e50; /* Darker color for prominence */
            white-space: normal; /* Allow wrapping if needed, but we control max-width */
            max-width: 80px; 
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.2;
            transition: color 0.3s;
        }

        .category-item-card:hover .category-name {
            color: #E94C3D; 
        }

        /* NOTIFICATION MODAL (ONLY) */
        .notification-modal {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 3000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(4px);
        }
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            max-height: 70vh;
            overflow-y: auto;
        }
        .modal-content h3 {
            color: #5a2e9d;
            margin-bottom: 15px;
            font-size: 18px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .notif-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #5a2e9d;
            font-size: 15px;
            line-height: 1.5;
        }
        .notif-time {
            font-size: 11px;
            color: #6c757d;
            margin-top: 5px;
        }
        .close-modal-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            font-weight: bold;
            color: #ccc;
            cursor: pointer;
        }
        .close-modal-btn:hover { color: #E94C3D; }

        /* --- DYNAMIC SECTION STYLES (UPDATED: Edge-to-Edge) --- */
        .dynamic-section {
            padding: 15px 0 10px; /* Horizontal padding removed for edge-to-edge */
            margin: 15px 0; 
            background: #ffffff; 
            border-radius: 0; /* Removed border radius for full width look */
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
            border: none; 
        }
        .dynamic-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 0 10px; /* Internal padding for header content */
        }
        .dynamic-section-title { 
            font-size: 20px; 
            font-weight: 700; 
            color: #E94C3D; 
            border-left: 4px solid #E94C3D;
            padding-left: 10px;
        }
        
        .section-footer-action {
            display: flex;
            justify-content: flex-end; 
            padding: 10px 10px 0; /* Internal padding for footer content */
            margin-top: 15px;
        }

        .show-more-btn {
            background: #2c3e50; 
            color: white; 
            border: none; 
            padding: 8px 16px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-weight: 500; 
            font-size: 14px;
            transition: background 0.2s;
        }
        .show-more-btn:hover {
            background: #34495e;
        }
        
        /* UPDATED GRID: Smaller Card Size and Edge-to-Edge Content Spacing */
        .section-product-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); /* Smaller min-width */
            gap: 10px; /* Reduced gap */
            padding: 0 10px; /* Added internal padding to keep items off screen edge */
        }
        @media (max-width: 400px) {
            .section-product-grid {
                 grid-template-columns: repeat(2, 1fr);
                 gap: 8px;
            }
        }
        
        /* NEW STYLES: Image-Only Card for Dynamic Sections */
        .product-card-image-only {
            padding: 0; 
            background: none; 
            box-shadow: none !important; /* Remove card shadow for cleaner look */
            border: none !important;
            border-radius: 0;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: transform 0.2s;
        }
        .product-card-image-only:hover { transform: translateY(-3px); }

        .product-card-image-only .product-image {
            height: 140px; /* Consistent height */
            margin: 0; 
            border-radius: 8px; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.1); 
            width: 100%;
            border: 2px solid transparent;
            transition: border-color 0.3s;
        }
        .product-card-image-only:hover .product-image {
            border-color: #FFC300;
        }

        /* FIX: Hiding other elements but ALLOWING .product-content (which contains the title) to show */
        .product-card-image-only .product-price,
        .product-card-image-only .ratings,
        .product-card-image-only .like-btn,
        .product-card-image-only .feature-badge,
        .product-card-image-only .gold-marker-container {
            display: none !important; 
        }

        /* Hide the custom label if the full title block is used */
        .product-card-image-only-label {
            display: none !important; 
        }

        /* Simple title/label for image-only card (shows product name below image) */
        .product-card-image-only .product-content {
            padding: 5px 0 0; /* Reduced padding to look like a label */
            align-items: center; /* Center the title */
            width: 100%;
        }
        .product-card-image-only .product-title {
            font-size: 12px; 
            font-weight: 600; 
            color: #555; 
            line-height: 1.2;
            text-align: center;
            min-height: auto; /* Allow height to adjust */
            -webkit-line-clamp: 2; /* Still allow 2 lines */
        }
        /* --- VIDEO BANNER STYLES (UNCHANGED) --- */
        .video-banner-card {
            background: white; 
            border-radius: 12px; 
            overflow: hidden; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.08); 
            cursor: pointer; 
            position: relative; 
            transition: transform 0.2s;
            border: 2px solid #5a2e9d; 
        }
        .video-banner-card:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
        
        .video-container {
            position: relative;
            padding-bottom: 177.78%; 
            height: 0; 
            background: #eee;
            overflow: hidden;
            display: flex;
            justify-content: center; 
            align-items: center;    
        }
        
        .video-element {
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%;
            height: 100%;
            object-fit: cover; 
        }

        .video-thumbnail-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 20; 
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: opacity 0.3s;
            background-size: cover; 
            background-position: center;
        }
        
        .play-button {
            font-size: 50px;
            color: white;
            background: rgba(255, 0, 0, 0.85); 
            border-radius: 12px; 
            width: 80px;
            height: 56px; 
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            transition: transform 0.2s;
        }
        .play-button i {
            font-size: 30px;
            margin-left: 5px; 
        }


        .video-container.playing .video-thumbnail-overlay { display: none; }
        .video-container:not(.playing) .video-element { visibility: hidden; }
        .video-container.playing .video-element { visibility: visible; }

        .video-icon-overlay {
            position: absolute;
            top: 8px;
            right: 8px;
            color: white;
            background: rgba(255, 0, 0, 0.7); 
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            z-index: 25; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        /* --- COMPACT PRODUCT LINK CSS (UNCHANGED) --- */
        .video-product-link {
            display: flex; 
            align-items: center;
            padding: 8px 10px;
            background: #f0f8ff;
            border-top: 1px solid #e0f2f1;
            text-decoration: none;
            color: #333; 
            transition: background 0.2s;
            overflow: hidden; 
        }

        .video-product-link:hover {
            background: #e3f2fd;
        }

        .product-thumb-small {
            width: 40px; 
            height: 40px; 
            min-width: 40px; 
            min-height: 40px; 
            border-radius: 6px;
            object-fit: cover;
            margin-right: 10px;
            border: 1px solid #ddd;
        }

        .product-link-content {
            flex-grow: 1; 
            overflow: hidden;
        }

        .product-link-title {
            font-size: 14px;
            font-weight: 600;
            color: #5a2e9d;
            white-space: nowrap; 
            overflow: hidden;
            text-overflow: ellipsis; 
        }

        .product-link-price {
            font-size: 12px;
            color: #E94C3D;
            font-weight: bold;
            margin-top: 2px;
        }

        .view-product-btn {
            margin-left: 10px;
            padding: 6px 10px;
            background: #FFC300;
            color: #2c3e50;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            white-space: nowrap;
            text-transform: uppercase;
        }
        /* --- END COMPACT PRODUCT LINK CSS --- */


        /* --- PRODUCT CARD STYLES (UPDATED: Smaller Size) --- */
        .brands-section { 
             padding: 10px 0 20px; /* Horizontal padding removed for edge-to-edge */
        }
        .section-title { 
            font-size: 20px; font-weight: 600; 
            color: #555; 
            margin-bottom: 15px; 
            border-left: 4px solid #FFC300;
            padding-left: 10px;
            margin-left: 10px; /* Internal alignment */
        }
        
        /* UPDATED GRID: Smaller Card Size and Edge-to-Edge Content Spacing */
        .products-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); /* Smaller min-width */
            gap: 10px; /* Reduced gap */
            padding: 0 10px 20px; /* Added internal padding to keep items off screen edge */
        }
        @media (max-width: 400px) {
            .products-grid {
                 grid-template-columns: repeat(2, 1fr);
                 gap: 8px;
            }
        }
        
        .product-card { 
            background: white; 
            border-radius: 8px; /* Slightly smaller radius */
            overflow: hidden; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.08); 
            cursor: pointer; 
            position: relative; 
            transition: transform 0.2s;
        }
        .product-card:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(0,0,0,0.1); }
        
        /* ðŸ‘‘ GOLD PRODUCT STYLES (UNCHANGED) ðŸ‘‘ */
        .product-card.gold-product {
            border: 3px solid #FFD700; 
            box-shadow: 
                0 0 10px #FFD700,
                0 0 20px #FFD700; 
        }
        .product-card.gold-product:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 0 15px #FFD700, 
                0 0 30px #FFD700;
        }

        .gold-marker-container {
            position: absolute; 
            top: 5px; 
            left: 5px; 
            z-index: 15; 
            display: flex;
            align-items: center;
            background: rgba(0, 0, 0, 0.7); 
            padding: 3px 8px;
            border-radius: 4px;
        }

        .gold-marker-container .crown-symbol {
            font-size: 1.2em; 
            margin-right: 5px;
        }

        .gold-marker-container .gold-text {
            color: #FFD700; 
            font-weight: bold;
            font-size: 14px;
            text-transform: uppercase;
            text-shadow: 0 0 5px #FFD700, 0 0 10px #FFC300;
        }
        /* END GOLD PRODUCT STYLES */

        .product-image { height: 140px; background: #eee center/cover; position: relative; } /* Reduced height */
        .like-btn { position: absolute; top: 8px; right: 8px; font-size: 18px; color: #E94C3D; background: rgba(255,255,255,0.8); border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        .product-content {
             padding: 8px 8px 5px; /* Reduced padding */
             display: flex; 
             flex-direction: column;
             gap: 4px; /* Reduced gap */
        }
        .product-title { 
            font-weight: 500; 
            font-size: 14px; /* Reduced font size */
            color: #333; 
            line-height: 1.3; 
            min-height: 36px; /* Adjusted min-height for 2 lines */
            margin-bottom: 0;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2; /* Title cut-off after 2 lines */
            -webkit-box-orient: vertical;
        }
        .product-price { padding: 0 8px 5px; display: flex; align-items: center; gap: 6px; flex-wrap: wrap; } /* Reduced padding/gap */
        .selling-price { font-weight: bold; font-size: 16px; color: #157347; } /* Reduced font size */
        .mrp { text-decoration: line-through; font-size: 12px; color: #999; } /* Reduced font size */
        .discount { color: #157347; font-weight: bold; font-size: 12px; background: #d4edda; padding: 2px 5px; border-radius: 4px;} /* Reduced font size/padding */
        .ratings { padding: 0 8px 8px; display: flex; justify-content: space-between; align-items: center; } /* Reduced padding */
        .rating-stars { background: #FFC300; color: #333; padding: 2px 6px; border-radius: 4px; font-size: 11px; font-weight: bold; } /* Reduced font size */
        
        .feature-badge { 
            position: absolute; top: 12px; left: 0; 
            padding: 4px 8px 4px 15px; 
            background: linear-gradient(to right, rgba(255,255,255,0.9), rgba(255,255,255,0.7)); 
            color: #333; 
            font-size: 11px; 
            font-weight: 700; 
            letter-spacing: 0.5px;
            z-index: 10;
            border-top-right-radius: 5px;
            border-bottom-right-radius: 5px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
        }
        .s-trusted-badge { 
            color: #5a2e9d; 
            border-left: 5px solid #8b5cf6; 
        }
        .branded-badge { 
            color: #E94C3D; 
            border-left: 5px solid #E94C3D; 
        }
        .seasonal-badge {
            display: inline-block; 
            margin: 0 10px;
            padding: 4px 8px;
            background: #f97316; 
            color: white;
            border-radius: 4px;
            font-size: 11px; 
            font-weight: 600;
            text-align: center;
            line-height: 1;
            margin-bottom: 5px;
        }

        /* --- FOOTER STYLES (UNCHANGED) --- */
        .footer {
            background: #2c3e50;
            color: white;
            padding: 30px 15px 20px;
            margin-top: 0;
            border-top: 1px solid #34495e;
            flex-shrink: 0;
        }
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .footer-links {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .footer-links a {
            color: #FFC300;
            text-decoration: none;
            font-weight: 500;
            font-size: 14px;
        }
        .footer-links a:hover {
            text-decoration: underline;
        }
        .footer-social {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }
        .footer-social a {
            color: white;
            font-size: 20px;
            transition: all 0.3s;
        }
        .footer-social a:hover {
            color: #FFC300;
            transform: translateY(-3px);
        }
        .footer-contact {
            font-size: 14px;
            color: #bdc3c7;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .footer-copyright {
            text-align: center;
            font-size: 13px;
            color: #95a5a6;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #34495e;
        }

        .main-content {
            flex: 1;
        }
        
        .loading-indicator {
            text-align: center;
            padding: 20px;
            font-size: 16px;
            color: #2c3e50;
            display: none;
            grid-column: 1/-1;
        }

        @media (max-width: 480px) {
            .footer { padding: 25px 10px 15px; }
            .footer-links { gap: 15px; flex-direction: column; }
            .footer-about { font-size: 13px; }
        }
    </style>
</head>
<body id="buyerBody">

    <div class="notification-modal" id="notificationModal" onclick="closeNotificationModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close-modal-btn" onclick="closeNotificationModal()">X</span>
            <h3>Announcements</h3>
            <div id="modalNotifList">
                <div style="text-align:center;color:#999;padding:20px;">Loading...</div>
            </div>
        </div>
    </div>

    <div class="header">
        <img src="logo.png" id="mainLogo" class="logo" alt="YesBag Logo">
        <div></div>
        <div class="icon-btn notification" onclick="trackClick('notificationIcon'); openNotificationModal()">
            <i class="fa-solid fa-bell"></i>
            <span id="notificationDot"></span>
        </div>
        <div class="icon-btn cart-icon" onclick="trackClick('cartIcon'); window.location.href='cart.html'">
            <i class="fa-solid fa-cart-shopping"></i><span id="cartBadge">0</span>
        </div>
        <div class="icon-btn hamburger" onclick="toggleHamburger()">
            <i class="fa-solid fa-bars"></i>
        </div>
        <div class="hamburger-menu" id="hamburgerMenu">
            <div class="hamburger-item" onclick="window.location.href='Buyorder.html'">Orders</div>
            <div class="hamburger-item" onclick="window.location.href='profile.html'">Profile</div>
            <div class="hamburger-item" onclick="window.location.href='settings.html'">Settings</div>
        </div>
    </div>

    <div class="main-content">

        <div class="search-container">
            <input type="text" class="search-bar" placeholder="Search Products, Stores, or Categories" onclick="openSearchPopup(); trackClick('searchBar')">
        </div>

        <div class="top-categories-section">
            <div id="topCategoriesContainer" class="top-categories-container">
                <div style="text-align:center; padding:10px 0; width:100%;">Loading Categories...</div>
            </div>
        </div>
        <div class="search-popup" id="searchPopup" onclick="closeSearchPopup(event)">
            <div class="search-popup-content" onclick="event.stopPropagation()">
                <input type="text" class="search-popup-input" id="popupSearchInput" placeholder="Search..." oninput="performSearch(this.value)">
                <div class="search-results" id="searchResults">
                     <div style="text-align:center;padding:20px;color:#999;grid-column:1/-1;">Start typing to see results...</div>
                </div>
            </div>
        </div>
        
        <div id="dynamicSectionsContainer"></div>

        <div class="brands-section">
            <div class="section-title">Featured Products</div>
            <div class="products-grid" id="productsList">
                <div style="text-align:center;padding:40px;color:#6c757d;grid-column:1/-1;">Loading Products...</div>
            </div>
             <div class="loading-indicator" id="productsLoadingIndicator">
                <i class="fas fa-spinner fa-spin"></i> Loading more products...
            </div>
            <div class="loading-indicator" id="productsEndMessage" style="display:none; color: #999;">
                All products loaded. Nothing more to see!
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-about">
                <strong>YesBag</strong> â€” Your trusted online shopping destination for quality products at unbeatable prices. Shop with confidence!
            </div>
            <div class="footer-links">
                <a href="about.html">About Us</a>
                <a href="privacy.html">Privacy Policy</a>
                <a href="terms.html">Terms of Service</a>
                <a href="contact.html">Contact</a>
            </div>
            <div class="footer-social">
                <a href="https://instagram.com/yesbag" target="_blank"><i class="fab fa-instagram"></i></a>
                <a href="https://facebook.com/yesbag" target="_blank"><i class="fab fa-facebook"></i></a>
            </div>
            <div class="footer-contact">
                <i class="fas fa-phone"></i> +91 98765 43210
            </div>
            <div class="footer-copyright">
                Â© 2025 YesBag. All rights reserved.
            </div>
        </div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, get, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // IMPORTANT: Replace with your actual Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyAmAI2z12tk2bnlm__JT24ZGr5giB7Wpk0",
            authDomain: "yesbag-84897.firebaseapp.com",
            databaseURL: "https://yesbag-84897-default-rtdb.firebaseio.com",
            projectId: "yesbag-84897",
            storageBucket: "yesbag-84897.firebasestorage.app",
            messagingSenderId: "2154662115",
            appId: "1:2154662115:web:3382afabeff5519510ddd6"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        
        let allProducts = [];
        let notifications = [];
        let videoBanners = []; 
        let seenNotifIds = new Set(JSON.parse(localStorage.getItem('seenNotifs') || '[]'));

        const PRODUCTS_PER_LOAD = 8;
        let productsRenderedCount = 0;
        let isLoading = false;
        let combinedItems = []; 

        // --- TRACKING FUNCTIONS (UNCHANGED) ---
        window.trackClick = async (elementName) => {
            const totalRef = ref(db, `admin/buyerHomePage/metrics/clicks/${elementName}`);
            const dailyRef = ref(db, `admin/dailyClicks/${elementName}/${Date.now()}`);
            
            try {
                const snap = await get(totalRef);
                const current = snap.val() || 0;
                await Promise.all([
                    set(totalRef, current + 1),
                    set(dailyRef, true)
                ]);
            } catch (e) {
                console.log("Click saved (fallback)");
            }
        };

        window.trackProductClick = async (productId) => {
            if (!productId || productId === 'unknown') return;
            const totalRef = ref(db, `admin/productClicks/${productId}`);
            const lastRef = ref(db, `admin/productClicks/${productId}_last`);
            const dailyRef = ref(db, `admin/dailyProductClicks/${productId}/${Date.now()}`);
            const now = Date.now();
            
            try {
                const snap = await get(totalRef);
                const current = snap.val() || 0;
                await Promise.all([
                    set(totalRef, current + 1),
                    set(lastRef, now),
                    set(dailyRef, true)
                ]);
            } catch (error) {
                console.warn("Product click track failed:", error);
            }
        };

        window.addEventListener('load', () => {
            if (!sessionStorage.getItem('homeVisited')) {
                trackClick('homeRedirects');
                sessionStorage.setItem('homeVisited', 'true');
            }
        });

        // --- UTILITY FUNCTIONS (UNCHANGED) ---
        
        // Utility function to shuffle an array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function loadDynamicLogo() {
            const logoRef = ref(db, 'admin/settings/logoUrl');
            const logoEl = document.getElementById('mainLogo');
            const defaultUrl = 'logo.png'; 
            onValue(logoRef, (snapshot) => {
                const logoUrl = snapshot.val();
                if (logoUrl) {
                    logoEl.src = logoUrl;
                } else {
                    logoEl.src = defaultUrl;
                }
            }, (error) => {
                console.error("Error loading logo URL:", error);
                logoEl.src = defaultUrl;
            });
        }

        function loadNotifications() {
            const notifsRef = ref(db, 'admin/buyerHomePage/notifications');
            onValue(notifsRef, (snap) => {
                const data = snap.val() || {};
                notifications = Object.entries(data)
                    .map(([id, n]) => ({ id, ...n }))
                    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                updateNotificationUI();
            });
        }

        function updateNotificationUI() {
            const dot = document.getElementById('notificationDot');
            const modalList = document.getElementById('modalNotifList');
            if (notifications.length === 0) {
                dot.style.display = 'none';
                modalList.innerHTML = '<div style="text-align:center;color:#999;padding:20px;">No announcements yet.</div>';
                return;
            }
            const hasUnseen = notifications.some(n => !seenNotifIds.has(n.id));
            dot.style.display = hasUnseen ? 'block' : 'none';
            modalList.innerHTML = notifications.map(n => {
                const time = new Date(n.timestamp).toLocaleString('en-IN', { day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit' });
                return `<div class="notif-item"><div>${n.message}</div><div class="notif-time">${time}</div></div>`;
            }).join('');
        }

        window.openNotificationModal = () => {
            document.getElementById('notificationModal').style.display = 'flex';
            notifications.forEach(n => seenNotifIds.add(n.id));
            localStorage.setItem('seenNotifs', JSON.stringify([...seenNotifIds]));
            document.getElementById('notificationDot').style.display = 'none';
        };

        window.closeNotificationModal = (e) => {
            if (!e || e.target === document.getElementById('notificationModal')) {
                document.getElementById('notificationModal').style.display = 'none';
            }
        };

        // Extract YouTube Video ID from URL (supports regular, short, and Shorts links)
        function extractYoutubeVideoId(url) {
            if (!url) return null;
            
            const regex = /(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|shorts\/|live\/|ytsapi\?feature=ytsapi&v=))([a-zA-Z0-9_-]{11})/;
            const match = url.match(regex);
            
            return (match && match[1]) ? match[1] : null;
        }

        // PRODUCT HELPER FUNCTION (Uses YouTube ID extractor)
        function getProductData(item, firebaseKey) {
            if (item.isVideo) {
                 const videoId = extractYoutubeVideoId(item.url); 
                 return {
                    id: item.productId,
                    url: item.url,
                    videoId: videoId, 
                    // YouTube Max Resolution Thumbnail for better vertical quality
                    thumbnailUrl: videoId ? `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg` : 'https://via.placeholder.com/320x570?text=YouTube+Video',
                    title: item.productTitle,
                    isVideo: true
                };
            }
            
            const discount = item.mrp && item.price ? Math.round(((item.mrp - item.price) / item.mrp) * 100) : 0;
            return {
                id: firebaseKey || item.id || item.productId || 'unknown',
                image: item.images?.[0] || 'https://via.placeholder.com/160?text=Product',
                title: item.title || 'Amazing Product',
                price: item.price || 999,
                mrp: item.mrp || 1299,
                discount: discount,
                offer: item.offer || null,
                totalRatings: item.totalRatings || 4.5, 
                usersRated: item.usersRated || 0, 
                firebaseKey: firebaseKey,
                markedAs: item.markedAs || '',
                category: item.category || '',
                isVideo: false
            };
        }
        
        function updateCartBadge() {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const badge = document.getElementById('cartBadge');
            if (cart.length > 0) {
                badge.textContent = cart.length;
                badge.style.display = 'block';
            } else {
                badge.style.display = 'none';
            }
        }

        // UPDATED: Play Video on Click (LOOP IMPLEMENTATION)
        window.playVideo = (element, videoId, productId) => {
            const container = element.closest('.video-container');
            if (!container) return;

            container.classList.add('playing');

            const iframe = container.querySelector('.video-element');
            
            // To loop a single video, you must include the 'playlist' parameter with the same video ID.
            const embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&modestbranding=1&loop=1&playlist=${videoId}`; 

            iframe.src = embedUrl;

            trackProductClick(productId);
        }

        // VIDEO BANNER HTML GENERATOR (with Compact Product Link) (UNCHANGED)
        function createVideoBannerHtml(videoData) {
            
            const videoId = videoData.videoId; 
            const thumbnailUrl = videoData.thumbnailUrl;
            
            if (!videoId) {
                return `
                    <div class="video-banner-card" style="display:flex; flex-direction:column; justify-content:center; align-items:center; height:160px; background:#ffebee; color:#E94C3D; text-align:center; padding:10px;">
                        <i class="fa-solid fa-triangle-exclamation" style="font-size:24px;"></i>
                        <div style="font-size:12px; margin-top:5px;">Invalid YouTube URL or Video ID not found.</div>
                    </div>
                `;
            }

            // Fetch product data for the compact link
            const productForLink = allProducts.find(p => p.firebaseKey === videoData.id);
            const productLinkData = productForLink ? getProductData(productForLink, productForLink.firebaseKey) : null;
            
            // Fallback content
            const linkImage = productLinkData ? productLinkData.image : 'https://via.placeholder.com/40?text=P';
            const linkTitle = productLinkData ? productLinkData.title : videoData.title || 'Related Product';
            const linkPrice = productLinkData ? `â‚¹${productLinkData.price}` : 'View Details';


            return `
                <div class="video-banner-card">
                    <div class="video-container" id="video-${videoId}"> 
                       
                       <div class="video-thumbnail-overlay" 
                            style="background-image: url('${thumbnailUrl}');"
                            onclick="playVideo(this, '${videoId}', '${videoData.id}');">
                            <div class="play-button">
                                <i class="fa-solid fa-play"></i>
                            </div>
                       </div>

                       <iframe class="video-element"
                            src="" 
                            frameborder="0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                            allowfullscreen
                            title="${videoData.title} Video Preview (YouTube)">
                       </iframe>
                       
                       <div class="video-icon-overlay">
                            <i class="fa-brands fa-youtube"></i>
                       </div>
                    </div>
                    
                    <a href="ProductShow.html?id=${videoData.id}"
                       onclick="trackProductClick('${videoData.id}'); trackClick('videoProductLink');" 
                       class="video-product-link">
                       
                       <img src="${linkImage}" class="product-thumb-small" alt="Product Image">
                       
                       <div class="product-link-content">
                           <div class="product-link-title">${linkTitle}</div>
                           <div class="product-link-price">${linkPrice}</div>
                       </div>
                       
                       <div class="view-product-btn">
                           <i class="fa-solid fa-arrow-right"></i>
                       </div>
                    </a>
                    </div>
            `;
        }


        // PRODUCT CARD HTML GENERATOR (UPDATED: Title truncation handled by CSS)
        function createProductCardHtml(productData) {
            let featureBadgeHtml = '';
            let seasonalBadgeHtml = '';
            let cardClasses = 'product-card'; 
            let goldMarkerHtml = ''; 
            
            if (productData.markedAs === 's-trusted') {
                featureBadgeHtml = '<div class="feature-badge s-trusted-badge">S-TRUSTED</div>';
            } else if (productData.markedAs === 'branded') {
                featureBadgeHtml = '<div class="feature-badge branded-badge">BRANDED</div>';
            } else if (productData.markedAs === 'seasonal') {
                seasonalBadgeHtml = '<span class="seasonal-badge">LIMITED TIME OFFER</span>';
            }

            if (productData.markedAs === 'gold') {
                 cardClasses += ' gold-product'; 
                 goldMarkerHtml = `
                    <div class="gold-marker-container">
                        <span class="crown-symbol">ðŸ‘‘</span> 
                        <span class="gold-text">GOLD</span>
                    </div>
                 `; 
            }
            
            const ratingStarsHtml = `<i class="fa-solid fa-star"></i> ${productData.totalRatings.toFixed(1)}`;
            
            return `
                <div class="${cardClasses}" 
                     onclick="trackProductClick('${productData.id}'); trackClick('productCard'); window.location.href='ProductShow.html?id=${productData.id}'">
                    <div class="product-image" style="background-image: url(${productData.image});">
                        <div class="like-btn"><i class="fa-regular fa-heart"></i></div>
                        ${featureBadgeHtml}
                        ${goldMarkerHtml} </div>
                    <div class="product-content">
                        <div class="product-title">${productData.title}</div>
                        ${seasonalBadgeHtml} 
                    </div>
                    <div class="product-price">
                        <span class="selling-price">â‚¹${productData.price}</span>
                        <span class="mrp">â‚¹${productData.mrp}</span>
                        <span class="discount">${productData.discount}% OFF</span>
                    </div>
                    ${productData.offer ? `<div class="offer"><i class="fa-solid fa-tags"></i> ${productData.offer}</div>` : ''}
                    <div class="ratings">
                        <span class="rating-stars">${ratingStarsHtml}</span>
                        <span class="rated-peoples">(${productData.usersRated} ratings)</span>
                    </div>
                </div>
            `;
        }
        
        // --- NEW/UPDATED: TOP CATEGORIES LOGIC (UNCHANGED) ---
        function loadTopCategories() {
            const categoriesRef = ref(db, 'admin/buyerHomePage/categories');
            const container = document.getElementById('topCategoriesContainer');

            onValue(categoriesRef, (snap) => {
                const data = snap.val() || {};
                
                // Map the object entries to include the Firebase Key as 'id'
                const categories = Object.entries(data)
                                        .map(([id, c]) => ({ id, ...c })); 

                if (categories.length === 0) {
                    container.innerHTML = '<div style="text-align:center; padding:10px 0; width:100%;">No categories defined by admin.</div>';
                    return;
                }
                
                const categoriesHtml = categories.map(c => `
                    <a href="category-products.html?id=${c.id}" 
                       class="category-item-card" 
                       onclick="trackClick('categoryClick_${c.id}')"
                       title="${c.name}">
                        <img src="${c.logoUrl}" class="category-logo" alt="${c.name} Logo">
                        <div class="category-name">${c.name}</div>
                    </a>
                `).join('');

                container.innerHTML = categoriesHtml;
            });
        }
        // --- END NEW LOGIC ---
        
        // --- DATA LOADING & RENDERING LOGIC (UNCHANGED) ---

        function loadVideoBanners() {
             const videosRef = ref(db, 'admin/buyerHomePage/videos');
             onValue(videosRef, (snap) => {
                const data = snap.val() || {};
                videoBanners = Object.values(data).map(v => ({ ...v, isVideo: true }));
                
                if (allProducts.length > 0) {
                    combineItemsAndRender();
                }
             });
        }
        
        function combineItemsAndRender() {
            // Start with shuffled products
            let productsToCombine = [...allProducts];
            combinedItems = [...productsToCombine]; 
            
            const interval = 6; 

            videoBanners.forEach((video, index) => {
                const insertionPoint = (index * interval) + Math.min(interval, combinedItems.length - 1); 
                
                if (insertionPoint < combinedItems.length) {
                    combinedItems.splice(insertionPoint, 0, video);
                } else {
                     combinedItems.push(video);
                }
            });

            if (productsRenderedCount === 0) {
                 renderNextProducts();
            } else {
                 productsRenderedCount = 0;
                 document.getElementById('productsList').innerHTML = '';
                 renderNextProducts();
            }
        }


        async function loadAllProductsAndReviews() {
            const productsRef = ref(db, 'products');
            const reviewsRef = ref(db, 'reviews');
            
            try {
                const [productSnapshot, reviewsSnapshot] = await Promise.all([get(productsRef), get(reviewsRef)]);
                const productsObj = productSnapshot.val() || {};
                const allReviews = Object.values(reviewsSnapshot.val() || {});

                allProducts = [];
                Object.entries(productsObj).forEach(([firebaseKey, product]) => {
                    if (product.isDraft === true || product.active === false) return; 

                    const productReviews = allReviews.filter(review => review.productId === firebaseKey);
                    let totalRating = 4.5;
                    if (productReviews.length > 0) {
                        totalRating = productReviews.reduce((sum, review) => sum + (review.rating || 0), 0) / productReviews.length;
                        totalRating = parseFloat(totalRating.toFixed(1));
                    } 

                    allProducts.push({ 
                        ...product, 
                        firebaseKey,
                        totalRatings: totalRating,
                        usersRated: productReviews.length 
                    });
                });
                
                // SHUFFLE PRODUCTS TO ENSURE RANDOM ORDER
                allProducts = shuffleArray(allProducts); 

                combineItemsAndRender(); 
                loadDynamicSections();

            } catch (error) {
                console.error("Error loading all products and reviews:", error);
                document.getElementById('productsList').innerHTML = '<div style="text-align:center;padding:40px;color:#dc3545;grid-column:1/-1;">Error loading data.</div>';
            }
        }

        // renderNextProducts (Simple rendering) 
        function renderNextProducts() {
            const productsList = document.getElementById('productsList');
            const loadingIndicator = document.getElementById('productsLoadingIndicator');
            const endMessage = document.getElementById('productsEndMessage');
            
            endMessage.style.display = 'none';

            if (productsRenderedCount >= combinedItems.length) { 
                loadingIndicator.style.display = 'none';
                isLoading = false;
                if (productsRenderedCount === 0) {
                     productsList.innerHTML = '<div style="text-align:center;padding:40px;color:#6c757d;grid-column:1/-1;">No products or banners available yet.</div>';
                } else {
                    endMessage.style.display = 'block'; 
                }
                return;
            }

            isLoading = true;
            loadingIndicator.style.display = 'block';
            
            const nextItems = combinedItems.slice(productsRenderedCount, productsRenderedCount + PRODUCTS_PER_LOAD);
            
            setTimeout(() => {
                const newItemsHtml = nextItems.map(item => {
                    const data = getProductData(item, item.firebaseKey);
                    return data.isVideo ? createVideoBannerHtml(data) : createProductCardHtml(data);
                }).join('');
                
                if (productsRenderedCount === 0) {
                    productsList.innerHTML = newItemsHtml;
                } else {
                    productsList.insertAdjacentHTML('beforeend', newItemsHtml);
                }
                
                productsRenderedCount += nextItems.length;
                isLoading = false;
                loadingIndicator.style.display = 'none';

                if (productsRenderedCount >= combinedItems.length) {
                    endMessage.style.display = 'block';
                }

            }, 500); 
        }

        function handleScroll() {
            const isNearBottom = (window.innerHeight + window.scrollY) >= (document.body.offsetHeight - 100);
            if (isNearBottom && !isLoading && productsRenderedCount < combinedItems.length) {
                renderNextProducts();
            }
        }
        window.addEventListener('scroll', handleScroll);

        function loadDynamicSections() {
            const sectionsRef = ref(db, 'admin/buyerHomePage/sections');
            const container = document.getElementById('dynamicSectionsContainer');
            
            onValue(sectionsRef, (snap) => {
                const sectionsObj = snap.val() || {};
                const sections = Object.entries(sectionsObj)
                    .map(([id, s]) => ({ id, ...s }))
                    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                if (sections.length === 0) {
                    container.innerHTML = '';
                    return;
                }
                
                container.innerHTML = sections.map(section => renderSection(section)).join('');
            });
        }

        /**
         * Renders a dynamic section, now using the standard card structure but with CSS
         * to hide price/ratings and show the title correctly.
         */
        function renderSection(section) {
            let filteredProducts = [];
            
            if (section.sourceType === 'stocked') {
                if (section.stockedCriteria === 's-trusted' || section.stockedCriteria === 'branded' || section.stockedCriteria === 'seasonal' || section.stockedCriteria === 'gold') {
                    filteredProducts = allProducts.filter(p => p.markedAs === section.stockedCriteria);
                } else if (section.stockedCriteria === 'discount' && section.discountPercentage) {
                    filteredProducts = allProducts.filter(p => {
                        const discount = getProductData(p).discount;
                        return discount >= section.discountPercentage;
                    });
                } else if (section.stockedCriteria === 'category') {
                    // Note: This logic needs refining if you want specific category filtering. 
                    // For now, it filters by a hardcoded 'electronics' if 'category' is the criteria.
                    filteredProducts = allProducts.filter(p => p.category && p.category.toLowerCase() === 'electronics');
                }
            } else if (section.sourceType === 'manual') {
                filteredProducts = allProducts.slice(0, 4);
            }
            
            filteredProducts = filteredProducts.slice(0, 4); // Limit to 4 products

            if (filteredProducts.length === 0) {
                 return `
                    <div class="dynamic-section">
                        <div class="dynamic-section-header">
                            <h2 class="dynamic-section-title">${section.name}</h2>
                        </div>
                        <div style="text-align:center;padding:20px 10px;color:#999;">No products currently match this criteria.</div>
                        <div class="section-footer-action">
                             <button class="show-more-btn" onclick="window.location.href='section.html?id=${section.id}'">Show More</button>
                        </div>
                    </div>
                `;
            }

            // â­ FIX: Using the standard product card function and then injecting the image-only class.
            const productsHtml = filteredProducts.map(product => {
                const data = getProductData(product, product.firebaseKey);
                
                // 1. Generate the standard product card HTML
                let cardHtml = createProductCardHtml(data);
                
                // 2. Inject the 'product-card-image-only' class into the main div to activate the custom CSS hiding price/ratings, but allowing the title.
                // Replaces 'class="product-card"' with 'class="product-card product-card-image-only"'
                cardHtml = cardHtml.replace('class="product-card', 'class="product-card product-card-image-only');

                return cardHtml;

            }).join('');

            return `
                <div class="dynamic-section">
                    <div class="dynamic-section-header">
                        <h2 class="dynamic-section-title">${section.name}</h2>
                    </div>
                    <div class="section-product-grid">
                        ${productsHtml}
                    </div>
                    <div class="section-footer-action">
                        <button class="show-more-btn" onclick="window.location.href='section.html?id=${section.id}'">Show More</button>
                    </div>
                </div>
            `;
        }
        
        // --- SEARCH POPUP LOGIC (UNCHANGED) ---

        window.performSearch = (query) => {
            const resultsEl = document.getElementById('searchResults');
            if (query.length < 2) {
                resultsEl.innerHTML = '<div style="text-align:center;padding:20px;color:#999;grid-column:1/-1;">Keep typing...</div>';
                return;
            }
            const results = allProducts.filter(p => p.title?.toLowerCase().includes(query.toLowerCase()));
            if (results.length === 0) {
                resultsEl.innerHTML = '<div style="text-align:center;padding:20px;color:#6c757d;grid-column:1/-1;">No products found.</div>';
                return;
            }
            resultsEl.innerHTML = results.map(product => {
                const data = getProductData(product, product.firebaseKey);
                return createProductCardHtml(data);
            }).join('');
        };

        window.openSearchPopup = () => {
            document.getElementById('searchPopup').style.display = 'flex';
            document.getElementById('popupSearchInput').focus();
        };

        window.closeSearchPopup = (event) => {
            if (event.target === document.getElementById('searchPopup')) {
                document.getElementById('searchPopup').style.display = 'none';
            }
        };

        window.toggleHamburger = () => {
            document.getElementById('hamburgerMenu').classList.toggle('show');
        };

        // --- INIT ---
        loadTopCategories(); 
        loadNotifications();
        loadVideoBanners(); 
        loadAllProductsAndReviews(); 
        updateCartBadge();
        loadDynamicLogo();
        window.addEventListener('storage', updateCartBadge); 
    </script>
</body>
</html>
